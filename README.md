# loyalty-gophermart

Промежуточный выпускной проект для курса "Профессия Golang-разработчик" от Яндекс.Практикум. 

# Техническое задание

Подробное ТЗ находится в файле [SPECIFICATION.md](doc/SPECIFICATION.md).

# Особенности реализации

1. В качестве СУБД используется PostgreSQL.
2. Храниение баллов лояльности организовано во float64 (c округлением до 2 знаков после запятой в БД). При реализации коммерческого проекта данный тип данных следует заменить на integer (хранение копеек) с приведением при сеарилизации/десериализации к float64.
3. Авторизация реализована с помощью JWT-токенов в хедере "Authorization".
4. Хранение паролей в БД пользователей организовано с помощью bcrypt.
5. Для обработки http запросов используется go-chi, для отправки запросов в систему начисления баллов - resty.
6. В качестве логгера используется zap. В chi логирование реализовано с помощью middleware и передачей экземпляра в хендлеры через структуру.

# changelog

## v0.1.2

1. Убрано избыточное логирование в orderprocessor. Для предотвращения отказа системы начисления баллов установлен таймаут в 1 секунду после обработки всего списка незавершенных заказов. Мок accrual system зависает при неогранниченных запросах вместо отдачи http 429
2. Добавлена обработка yaml конфигурации при старте сервера. Изменение настроек возможно переменными окружения и флагами запуска (кроме параметров шифрования)
3. Убрано хранение секретов в коде.
4. Коды ошибок http сервера/клиента для удобочитаемости приведены к константным из пакета http.
5. Логгирование в middleware сокращено.
6. Переписаны маршруты в роутере для удобочитаемости. Логика обработки пути запроса удалена из middleware.
7. Переименованы хендлеры для удобочитаемости.
8. Уровень логирования устанавливается в yaml конфигурации.
9. Данные с omitempty полями в структурах используются с указателями.
10. Исправлена логика поиска и обработки наличия существующего заказа при добавлении нового с тем же номером.
